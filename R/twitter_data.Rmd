---
title: '@jumping_uk Twitter Analysis'
author: "David Saipe"
date: '2022-07-06'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rtweet)
library(dplyr)
library(ggplot2)
library(stringr)
library(lubridate)
library(patchwork)
library(tidyr)
library(magrittr)
```

```{r jr timeline, include = FALSE}
jr_timeline = read.csv("Data/jr_timeline.csv")

jr_timeline %<>%
  filter(is_retweet == FALSE)
jr_timeline %<>%
  select(status_id, created_at, favorite_count, retweet_count, mentions_screen_name, urls_url, hashtags, media_type)
jr_timeline %<>%
  mutate(hour_posted = hour(created_at), interactions = retweet_count + favorite_count)
jr_timeline$status_id = gsub("x", "", as.character(jr_timeline$status_id))
```

```{r #rstats, include = FALSE}
rstats = read.csv("Data/rstats_hashtag.csv")

rstats %<>%
  select(created_at, favorite_count, retweet_count, hashtags, media_type, urls_url, mentions_screen_name)
rstats %<>%
  mutate(hashtag_num = str_count(hashtags, "\\w+"),
         interactions = retweet_count + favorite_count)

```

```{r time posted, echo = FALSE}
avg_interactions = jr_timeline %>%
  group_by(hour_posted) %>%
  summarise(avg_interactions = mean(interactions))

ggplot(avg_interactions, aes(hour_posted, avg_interactions)) +
  geom_bar(stat = "identity") +
  xlim(6,23) +
  xlab("Hour Posted") + 
  ylab("Average Number of Interactions")

morning_retweeters = read.csv("Data/morning_retweeters.csv")
morning_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())
morning_retweeters = morning_retweeters[-c(38:57),]

afternoon_retweeters = read.csv("Data/afternoon_retweeters.csv")
afternoon_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())
afternoon_retweeters = afternoon_retweeters[-c(41:71),]

am = ggplot(morning_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Morning") +
  theme_void() +
  theme(plot.subtitle = element_text(hjust = 0.5))

pm = ggplot(afternoon_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Afternoon") +
  theme_void() +
  theme(legend.position = "none",
        plot.subtitle = element_text(hjust = 0.5)) 

(am + pm) +
  labs(title = "Retweeter Locations") +
  theme(plot.title = element_text(hjust = -15))

rstats_followers = read.csv("Data/rstats_followers.csv")
rstats_followers %<>%
  group_by(location) %>%
  mutate(count = n())
ggplot(rstats_followers, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(title = "Locations of @rstatstweet followers") +
  theme_void() 
```

```{r images, echo = FALSE}
rstats = rstats[-c(29, 3913),]

avg_interactions = jr_timeline %>%
  group_by(media_type) %>%
  summarise(jr_interactions = mean(interactions))
avg_interactions %<>%
  mutate(rstats %>%
           group_by(media_type) %>%
           summarise(rstats_interactions = mean(interactions)))

avg_interactions$media_type[1] = c("None")
avg_interactions$media_type[2] = c("Photo")

avg_interactions %>%
  pivot_longer(cols = c("jr_interactions",
                      "rstats_interactions"),
             names_to = "interactions",
             values_to = "count") %>%
  ggplot(aes(x = media_type, y = count, 
             fill = interactions)) +
  geom_col(position = "dodge") +
  xlab("Media") +
  ylab("Average Interactions") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Source",
                    labels = c("@jumping_uk", "#rstats")) +
  theme_classic()
```


```{r hashtags, echo = FALSE}
ggplot(rstats) +
  geom_smooth(aes(hashtag_num, interactions)) +
  xlim(0,40) +
  ylim(0,90) +
  xlab("Number of hashtags used") + 
  ylab("Number of interactions")
  
```

```{r retweeters, echo = FALSE}
retweeters = read.csv("Data/retweeters.csv")


```




