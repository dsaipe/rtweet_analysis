---
title: '@jumping_uk Twitter Analysis'
author: "David Saipe"
date: '2022-07-06'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rtweet)
library(dplyr)
library(ggplot2)
library(stringr)
library(lubridate)
library(patchwork)
library(tidyr)
library(magrittr)
library(plotrix)
```

```{r jr timeline, include = FALSE}
jr_timeline = read.csv("Data/jr_timeline.csv")

jr_timeline %<>%
  filter(is_retweet == FALSE) %>%
  select(status_id, created_at, favorite_count, retweet_count, mentions_screen_name, urls_url, hashtags, media_type) %>%
  mutate(hour_posted = hour(created_at), interactions = retweet_count + favorite_count)
jr_timeline$status_id = gsub("x", "", as.character(jr_timeline$status_id))
```

```{r #rstats, include = FALSE}
rstats = read.csv("Data/rstats_hashtag.csv")

rstats %<>%
  select(screen_name, followers_count, created_at, favorite_count, retweet_count, hashtags, media_type, urls_url, mentions_screen_name) %>%
  mutate(hashtag_num = str_count(hashtags, "\\w+"),
         interactions = retweet_count + favorite_count,
         hour_posted = hour(created_at))

```

```{r time posted, echo = FALSE}
avg_interactions = jr_timeline %>%
  group_by(hour_posted) %>%
  summarise(avg_interactions = mean(interactions),
            se = std.error(interactions))

avg_interactions = avg_interactions[-c(1,2),]

ggplot(avg_interactions, aes(hour_posted, avg_interactions)) +
  geom_bar(fill = "#d95f02",  color = "black",
           stat = "identity") +
  geom_errorbar(aes(ymin = avg_interactions - se,
                    ymax = avg_interactions + se),
                width = .2) +
  labs(subtitle = "Tweets by @jumping_uk from 2016 to 2022") +
  xlim(6,24) +
  xlab("Hour Posted") + 
  ylab("Average Number of Interactions") +
  theme_classic()

morning_retweeters = read.csv("Data/morning_retweeters.csv")
morning_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())
morning_retweeters = morning_retweeters[-c(38:57),]

afternoon_retweeters = read.csv("Data/afternoon_retweeters.csv")
afternoon_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())
afternoon_retweeters = afternoon_retweeters[-c(41:71),]

am = ggplot(morning_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Morning") +
  theme_void() +
  theme(plot.subtitle = element_text(hjust = 0.5))

pm = ggplot(afternoon_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Afternoon") +
  theme_void() +
  theme(legend.position = "none",
        plot.subtitle = element_text(hjust = 0.5)) 

(am + pm) +
  labs(title = "Locations of @jumping_uk retweeters (excluding UK)") +
  theme(plot.title = element_text(hjust = 1.2))

rstats_followers = read.csv("Data/rstats_followers.csv")
rstats_followers %<>%
  group_by(location) %>%
  mutate(count = n())
ggplot(rstats_followers, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(title = "Locations of @rstatstweet followers") +
  theme_void()
```

```{r images, echo = FALSE}
rstats = rstats[-c(29, 3913),]

avg_interactions = jr_timeline %>%
  group_by(media_type) %>%
  summarise(jr_interactions = mean(interactions))
avg_interactions %<>%
  mutate(rstats %>%
           group_by(media_type) %>%
           summarise(rstats_interactions = mean(interactions)))

avg_interactions$media_type[1] = c("None")
avg_interactions$media_type[2] = c("Photo")

avg_interactions %>%
  pivot_longer(cols = c("jr_interactions",
                      "rstats_interactions"),
             names_to = "interactions",
             values_to = "count") %>%
  ggplot(aes(x = media_type, y = count, 
             fill = interactions)) +
  geom_col(position = "dodge") +
  xlab("Media") +
  ylab("Average Interactions") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Source",
                    labels = c("@jumping_uk", "#rstats")) +
  theme_classic()
```

```{r hashtags, echo = FALSE}
ggplot(rstats) +
  geom_smooth(aes(hashtag_num, interactions)) +
  xlim(0,40) +
  ylim(0,90) +
  xlab("Number of hashtags used") + 
  ylab("Number of interactions")

jr_hashtags = tibble(
  hashtags = c("rstats", "stats", "datascience", "python",
               "machinelearning", "bigdata"),
  interactions_used = c(9.37, 9.45, 8.48, 8.26, 4.86, 9.75),
  interactions_not_used = c(4.71, 4.51, 6.69, 6.7, 6.89, 6.84)
)

jr_hashtags %>% 
  pivot_longer(
    cols = c("interactions_used", "interactions_not_used"),
    names_to = c("interactions"),
    values_to = c("count")
  ) %>%
  ggplot(aes(hashtags, count, fill = interactions)) +
  geom_col(position = "dodge") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Hashtag Used",
                    labels = c("No", "Yes")) +
  labs(title = "Effect of hashtags on interaction with @jumping_uk tweets") +
  xlab("Hashtag") +
  ylab("Average Interactions") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30,
                                   size = 6,
                                   vjust = 0.7),
        plot.title = element_text(hjust = 0.3))

rstats_hashtags = tibble(
  hashtags = c("stats", "datascience", "python", 
               "machinelearning", "bigdata"),
  used = c(37.71, 35.73, 37.28, 36.1, 40.3),
  not_used = c(21.21, 24.62, 24, 25.14, 22.35)
)
rstats_hashtags %>%
  pivot_longer(cols = c("used", "not_used"),
               names_to = "interactions",
               values_to = "count") %>%
  ggplot(aes(hashtags, count, fill = interactions)) +
           geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2", 
                    name = "Hashtag Used",
                    labels = c("No", "Yes")) +
  labs(title = "Impact of hashtags commonly used with #rstats") +
  xlab("Hashtag") +
  ylab("Average Interactions") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30,
                                   size = 6,
                                   vjust = 0.7),
        plot.title = element_text(hjust = 0.5))

```

```{r retweeters, echo = FALSE}
retweeters = read.csv("Data/retweeters.csv")

jr = c("csgillespie", "nrennie35", "StatsRhian", 
       "MandyNorrbo", "clayyb93", "AbrahamsAmieroh",
       "jwalton3141", "parisagregg", "haematobot",
       "_jcken", "TimBrock_DtD")

retweeters %<>%
  mutate(jumping_rivers = screen_name %in% jr) %>%
  select(user_id, screen_name, followers_count, jumping_rivers)

```




