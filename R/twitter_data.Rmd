---
title: '@jumping_uk Twitter Analysis'
author: "David Saipe"
date: '2022-07-06'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rtweet)
library(dplyr)
library(ggplot2)
library(stringr)
library(lubridate)
library(patchwork)
library(tidyr)
library(magrittr)
library(plotrix)
library(tidytext)
library(ggwordcloud)
```

```{r jr timeline, echo = FALSE}
jr_timeline = read.csv("Data/jr_timeline.csv")

jr_timeline %<>%
  filter(is_retweet == FALSE) %>%
  select(status_id, created_at, text, favorite_count, retweet_count, mentions_screen_name, urls_url, hashtags, media_type) %>%
  mutate(hour_posted = hour(created_at), 
         interactions = retweet_count + favorite_count,
         year = year(created_at))
jr_timeline$status_id = gsub("x", "", as.character(jr_timeline$status_id))

ggplot(jr_timeline, aes(year)) +
  geom_point(stat = "count") +
  geom_line(stat = "count") +
  xlim(2017,2022) +
  theme_classic() +
  xlab("Year") +
  ylab("Number of Tweets")

tweet_words = unnest_tokens(
  tbl = jr_timeline,
  output = word,
  input = text
)

custom_stop_words = c("t.co", "https" , "0001f40d", "fe0f",
                      "2728", "0001f389", "ukhkqhxhwg", "custom",
                      "upcoming", "time", "newcastle", "jumping",
                      "rivers", "north", "team", "amp", "check",
                      "east", "csgillespie", "info", "read", "Ã¢",
                      "mcmc_stan")
tweet_words = anti_join(tweet_words, 
                        stop_words, 
                        by = "word")
tweet_words %<>%
  select(word)

word_counts = count(tweet_words, word, sort = TRUE)
word_counts = filter(word_counts,
                     !(word %in% custom_stop_words))

word_counts %>%
  slice_max(n, n = 20) %>%
  ggplot(aes(label = word, size = n)) + 
  geom_text_wordcloud() +
  scale_size_area(max_size = 10) +
  theme_void()
```

```{r #rstats, include = FALSE}
rstats = read.csv("Data/rstats_hashtag.csv")

rstats %<>%
  select(screen_name, created_at, favorite_count, retweet_count, hashtags, media_type, mentions_screen_name, urls_url) %>%
  mutate(hashtag_num = str_count(hashtags, "\\w+"),
         interactions = retweet_count + favorite_count,
         hour_posted = hour(created_at))
```

```{r day of the week, echo = FALSE}
by_weekday = jr_timeline %>%
  mutate(day = wday(created_at))

avg_weekday = by_weekday %>%
  group_by(day) %>%
  summarise(avg_rt = mean(retweet_count), 
            avg_fav = mean(favorite_count))
avg_weekday$day = c("Sun", "Mon", "Tue", "Wed", 
                    "Thu", "Fri", "Sat")
avg_weekday$day = factor(avg_weekday$day,
                         c("Mon", "Tue", "Wed", 
                           "Thu", "Fri", "Sat", "Sun"))

avg_weekday %>%
  pivot_longer(cols = c("avg_rt", "avg_fav"),
               names_to = c("avg_interactions"),
               values_to = c("count")) %>%
                 ggplot(aes(day, count, fill = avg_interactions)) + 
  geom_col(position = "dodge") +
  labs(caption = "Taken from @jumping_uk timeline from 2016 to 2022") +
  xlab("Day") +
  ylab("Average Interactions") +
  scale_fill_brewer(palette = "Dark2",
                    name = "",
                    labels = c("Likes", "Retweets")) +
  theme_classic()
```

## Time posted

From looking at the @jumping_uk timeline, there are two average peaks in 
engagement: one from 9-12am, and another from 3-6pm, as shown below. 

Examining the locations of people retweeting @jumping_uk tweets, there is a 
higher proportion of retweeters in the  afternoon peak that are from America, 
with a lower proportion being from Asia and Africa. The proportion of retweeters
from the UK remains similar throughout the day (just under 50%). It should also 
be taken into account that around 75% of @rstatstweet followers are from America, 
so tweets containing #rstats may receive more engagement in the afternoon.

```{r time posted, echo = FALSE}
avg_interactions = jr_timeline %>%
  group_by(hour_posted) %>%
  summarise(avg_interactions = mean(interactions),
            se = std.error(interactions))

avg_interactions = avg_interactions[-c(1,2),]

ggplot(avg_interactions, aes(hour_posted, avg_interactions)) +
  geom_bar(fill = "#d95f02",  color = "black",
           stat = "identity") +
  geom_errorbar(aes(ymin = avg_interactions - se,
                    ymax = avg_interactions + se),
                width = .2) +
  labs(subtitle = "Tweets by @jumping_uk from 2016 to 2022") +
  xlim(6,24) +
  xlab("Hour Posted") + 
  ylab("Average Number of Interactions") +
  theme_classic()

morning_retweeters = read.csv("Data/morning_retweeters.csv")
morning_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())
#morning_retweeters = morning_retweeters[-c(38:57),]

afternoon_retweeters = read.csv("Data/afternoon_retweeters.csv")
afternoon_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())
#afternoon_retweeters = afternoon_retweeters[-c(41:71),]

am = ggplot(morning_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Morning") +
  theme_void() +
  theme(plot.subtitle = element_text(hjust = 0.5))

pm = ggplot(afternoon_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Afternoon") +
  theme_void() +
  theme(legend.position = "none",
        plot.subtitle = element_text(hjust = 0.5)) 

(am + pm) +
  labs(title = "Locations of @jumping_uk retweeters") +
  theme(plot.title = element_text(hjust = 1.4))

rstats_followers = read.csv("Data/rstats_followers2.csv")
rstats_followers = rstats_followers[1:216,]
rstats_followers %<>%
  select(location)
rstats_followers %<>%
  group_by(location) %>%
  mutate(count = n())
ggplot(rstats_followers, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(title = "Locations of @rstatstweet followers") +
  theme_void()
```

## Images

As predicted, images do affect levels of engagement positively. The figure below 
shows the average levels of interaction for tweets with no media and tweets with 
photos, taken from both the #rstats timeline and the @jumping_uk timeline.

```{r images, echo = FALSE}
rstats = rstats[-c(29, 3913),]

avg_interactions = jr_timeline %>%
  group_by(media_type) %>%
  summarise(jr_interactions = mean(interactions))
avg_interactions %<>%
  mutate(rstats %>%
           group_by(media_type) %>%
           summarise(rstats_interactions = mean(interactions)))

avg_interactions$media_type[1] = c("None")
avg_interactions$media_type[2] = c("Photo")

avg_interactions %>%
  pivot_longer(cols = c("jr_interactions",
                      "rstats_interactions"),
             names_to = "interactions",
             values_to = "count") %>%
  ggplot(aes(x = media_type, y = count, 
             fill = interactions)) +
  geom_col(position = "dodge") +
  xlab("Media") +
  ylab("Average Interactions") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Source",
                    labels = c("@jumping_uk", "#rstats")) +
  theme_classic()
```

## Hashtags

Below are the top 30 hashtags used alongside #rstats, taken from the most 
popular tweets containing #rstats (07/07 - 14/07). The impact of some of these 
hashtags when used alongside #rstats are shown below. 

@jumping_uk uses #rstats, #datascience, #python, #tidyverse and #shiny most often. 
The bar chart below shows the impact of these four hashtags when used 
alongside #rstats. @jumping_uk doesn't use #machinelearning and #bigdata as often 
but the figure below above that these have a significant impact on engagement, 
so could be used more often in the future. 

There are also hashtag trends such as #100daysofcode and #tidytuesdays which 
could be good ways to appear more on the RStats community timeline (there are 
two accounts that retweet all tweets with #100daysofcode). 

```{r hashtags, echo = FALSE}
rstats_top = rstats %>%
  filter(interactions >= 225)
hashtag_count = unnest_tokens(tbl = rstats_top,
                            output = word,
                            input = hashtags)
hashtag_count = count(hashtag_count, word, sort = TRUE)
hashtag_count %>%
  slice_max(n, n = 30) %>%
  ggplot(aes(label = word, size = n)) +
  geom_text_wordcloud() +
  scale_size_area(max_size = 10) +
  labs(title = "Hashtags used alongside #rstats",
       caption = "Taken from the top 100 most popular tweets containing #rstats") +
  theme_void()

jr_hashtags = tibble(
  hashtags = c("shiny", "datascience", "python",
               "tidyverse"),
  interactions_used = c(13.6, 10.8, 10.6, 11.4),
  interactions_not_used = c(9.2, 9.3, 9.4, 9.5)
)

jr_hashtags %>% 
  pivot_longer(
    cols = c("interactions_used", "interactions_not_used"),
    names_to = c("interactions"),
    values_to = c("count")
  ) %>%
  ggplot(aes(hashtags, count, fill = interactions)) +
  geom_col(position = "dodge") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Hashtag Used",
                    labels = c("No", "Yes")) +
  labs(title = "Effect of hashtags used alongside #rstats",
       caption = "Taken from @jumping_uk timeline") +
  xlab("Hashtag") +
  ylab("Average Interactions") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30,
                                   size = 6,
                                   vjust = 0.7),
        plot.title = element_text(hjust = 0.3))

rstats_hashtags = tibble(
  hashtags = c("stats", "datascience", "python", 
               "machinelearning", "bigdata"),
  used = c(80.71, 35.73, 37.28, 36.1, 40.3),
  not_used = c(29.45, 24.62, 24, 25.14, 22.35)
)
rstats_hashtags %>%
  pivot_longer(cols = c("used", "not_used"),
               names_to = "interactions",
               values_to = "count") %>%
  ggplot(aes(hashtags, count, fill = interactions)) +
           geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2", 
                    name = "Hashtag Used",
                    labels = c("No", "Yes")) +
  labs(title = "Impact of hashtags commonly used with #rstats") +
  xlab("Hashtag") +
  ylab("Average Interactions") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30,
                                   size = 6,
                                   vjust = 0.7),
        plot.title = element_text(hjust = 0.5))

```

```{r retweeters, echo = FALSE}
retweeters = read.csv("Data/retweeters.csv")

jr = c("csgillespie", "nrennie35", "StatsRhian", 
       "MandyNorrbo", "clayyb93", "AbrahamsAmieroh",
       "jwalton3141", "parisagregg", "haematobot",
       "_jcken", "TimBrock_DtD")

retweeters %<>%
  mutate(jumping_rivers = screen_name %in% jr) %>%
  select(user_id, screen_name, followers_count, jumping_rivers)

```


