---
title: '@jumping_uk Twitter Analysis'
author: "David Saipe"
date: '2022-07-06'
output: html_document
fig_width: 6
fig_height: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rtweet)
library(dplyr)
library(ggplot2)
library(stringr)
library(lubridate)
library(patchwork)
library(tidyr)
library(magrittr)
library(tidytext)
library(ggwordcloud)
```

## Introduction

The @jumping_uk account has been active since March 2016 and has almost 8000 followers. The account is currently posting very regularly (most weekdays). The graph below shows how many tweets @jumping_uk have posted each year since joining twitter. 

```{r jr timeline, echo = FALSE, }
jr_timeline = read.csv("Data/jr_timeline.csv")

jr_timeline %<>%
  filter(is_retweet == FALSE) %>%
  select(status_id, created_at, text, favorite_count, retweet_count, mentions_screen_name, urls_url, hashtags, media_type) %>%
  mutate(hour_posted = hour(created_at), 
         interactions = retweet_count + favorite_count,
         year = year(created_at))
jr_timeline$status_id = gsub("x", "", as.character(jr_timeline$status_id))

ggplot(jr_timeline, aes(year)) +
  geom_point(stat = "count") +
  geom_line(stat = "count") +
  xlim(2017,2021) +
  theme_classic() +
  xlab("Year") +
  ylab("Number of Tweets")
```

This report will look into several factors that affect levels of engagement on Twitter - including what day and time a tweet is posted, the use of hashtags and the use of media. I have used the RTweet package to get the data for this analyses, and have primarily been looking at data from the @jumping_uk timeline, as well as general tweets using the hashtag #rstats. 

```{r #rstats, include = FALSE}
rstats = read.csv("Data/rstats_hashtag.csv")

rstats %<>%
  select(screen_name, created_at, favorite_count, retweet_count, hashtags, media_type, mentions_screen_name, urls_url) %>%
  mutate(hashtag_num = str_count(hashtags, "\\w+"),
         interactions = retweet_count + favorite_count,
         hour_posted = hour(created_at))
```

## Best day of the week to post

It is widely agreed upon that tweets posted on the weekend will receive less engagement from the users audience. @jumping_uk's timeline corroborates with this. Tweets posted on Saturdays and Sundays have generally received significantly less retweets and likes. 

```{r day of the week, echo = FALSE}
by_weekday = jr_timeline %>%
  mutate(day = wday(created_at))

avg_weekday = by_weekday %>%
  group_by(day) %>%
  summarise(avg_rt = mean(retweet_count), 
            avg_fav = mean(favorite_count))
avg_weekday$day = c("Sun", "Mon", "Tue", "Wed", 
                    "Thu", "Fri", "Sat")
avg_weekday$day = factor(avg_weekday$day,
                         c("Mon", "Tue", "Wed", 
                           "Thu", "Fri", "Sat", "Sun"))

avg_weekday %>%
  pivot_longer(cols = c("avg_rt", "avg_fav"),
               names_to = c("avg_interactions"),
               values_to = c("count")) %>%
                 ggplot(aes(day, count, fill = avg_interactions)) + 
  geom_col(position = "dodge") +
  labs(caption = "Taken from @jumping_uk timeline from 2016 to 2022") +
  xlab("Day") +
  ylab("Average Interactions") +
  scale_fill_brewer(palette = "Dark2",
                    name = "",
                    labels = c("Likes", "Retweets")) +
  theme_classic()
```

## Time posted

From looking at the @jumping_uk timeline, there are two average peaks in 
engagement: one from 9-12am, and another from 3-6pm, as shown below. 

```{r time posted, echo = FALSE}
avg_interactions = jr_timeline %>%
  group_by(hour_posted) %>%
  summarise(avg_interactions = mean(interactions))

avg_interactions = avg_interactions[-c(1,2),]

ggplot(avg_interactions, aes(hour_posted, avg_interactions)) +
  geom_bar(fill = "#d95f02",  color = "black",
           stat = "identity") +
  labs(caption = "Taken from @jumping_uk timeline from 2016 to 2022") +
  xlim(6,24) +
  xlab("Hour Posted") + 
  ylab("Average Number of Interactions") +
  theme_classic()
```

Examining the locations of people retweeting @jumping_uk tweets, there is a 
higher proportion of retweeters in the  afternoon peak that are from America, 
with a lower proportion being from Asia and Africa. The proportion of retweeters
from the UK remains similar throughout the day (just under 50%).

```{r retweeter locations, echo = FALSE}
morning_retweeters = read.csv("Data/morning_retweeters.csv")
morning_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())

afternoon_retweeters = read.csv("Data/afternoon_retweeters.csv")
afternoon_retweeters %<>%
  group_by(location) %>%
  mutate(count = n())

am = ggplot(morning_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Morning peak: 9am - 12pm") +
  theme_void() +
  theme(plot.subtitle = element_text(hjust = 0.5),
        legend.position = "none")

pm = ggplot(afternoon_retweeters, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(subtitle = "Afternoon peak: 3pm - 6pm") +
  theme_void() +
  theme(plot.subtitle = element_text(hjust = 0.5)) 

am +
  labs(title = "Location of @jumping_uk retweeters") + 
  pm
```

It should also 
be taken into account that around 75% of @rstatstweet followers are from America, 
so tweets containing #rstats may receive more engagement in the afternoon.

```{r rstats follower locations, echo = FALSE}
rstats_followers = read.csv("Data/rstats_followers2.csv")
rstats_followers = rstats_followers[1:216,]
rstats_followers %<>%
  select(location)
rstats_followers %<>%
  group_by(location) %>%
  mutate(count = n())
ggplot(rstats_followers, 
       aes(x = "", y = count, fill = location)) +
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start = 0) +
  scale_fill_brewer(palette = "Dark2", name = "Continent") +
  labs(title = "Locations of @rstatstweet followers",
       caption = "Based off a sample of 500 followers") +
  theme_void()
```

## Images

As predicted, images do affect levels of engagement positively. The figure below 
shows the average levels of interaction for tweets with no media and tweets with 
photos, taken from both the #rstats timeline and the @jumping_uk timeline.

```{r images, echo = FALSE}
rstats = rstats[-c(29, 3913),]

avg_interactions = jr_timeline %>%
  group_by(media_type) %>%
  summarise(jr_interactions = mean(interactions))
avg_interactions %<>%
  mutate(rstats %>%
           group_by(media_type) %>%
           summarise(rstats_interactions = mean(interactions)))

avg_interactions$media_type[1] = c("None")
avg_interactions$media_type[2] = c("Photo")

avg_interactions %>%
  pivot_longer(cols = c("jr_interactions",
                      "rstats_interactions"),
             names_to = "interactions",
             values_to = "count") %>%
  ggplot(aes(x = media_type, y = count, 
             fill = interactions)) +
  geom_col(position = "dodge") +
  xlab("Media") +
  ylab("Average Interactions") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Source",
                    labels = c("@jumping_uk", "#rstats")) +
  theme_classic()
```

## Hashtags

Below are the top 30 hashtags used alongside #rstats, taken from the most 
popular tweets containing #rstats (07/07 - 14/07). The impact of some of these 
hashtags when used alongside #rstats are shown below. 

```{r hashtags wordcloud, echo = FALSE}
rstats_top = rstats %>%
  filter(interactions >= 225)
hashtag_count = unnest_tokens(tbl = rstats_top,
                            output = word,
                            input = hashtags)
hashtag_count = count(hashtag_count, word, sort = TRUE)
hashtag_count %>%
  slice_max(n, n = 30) %>%
  ggplot(aes(label = word, size = n)) +
  geom_text_wordcloud() +
  scale_size_area(max_size = 10) +
  labs(caption = "Taken from the top 100 most popular tweets containing #rstats from 07/07 - 14/07") +
  theme_void()
```

@jumping_uk uses #datascience, #python, #tidyverse and #shiny most often. 
The bar chart below shows the impact of these four hashtags when used 
alongside #rstats.

```{r jr hashtags, echo = FALSE}
jr_hashtags = tibble(
  hashtags = c("shiny", "datascience", "python",
               "tidyverse"),
  interactions_used = c(13.6, 10.8, 10.6, 11.4),
  interactions_not_used = c(9.2, 9.3, 9.4, 9.5)
)

jr_hashtags %>% 
  pivot_longer(
    cols = c("interactions_used", "interactions_not_used"),
    names_to = c("interactions"),
    values_to = c("count")
  ) %>%
  ggplot(aes(hashtags, count, fill = interactions)) +
  geom_col(position = "dodge") + 
  scale_fill_brewer(palette = "Dark2", 
                    name = "Hashtag Used",
                    labels = c("No", "Yes")) +
  labs(title = "Impact of hashtags used alongside #rstats",
       caption = "Taken from @jumping_uk timeline from 2016 to 2022") +
  xlab("Hashtag") +
  ylab("Average Interactions") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30,
                                   size = 6,
                                   vjust = 0.7),
        plot.title = element_text(hjust = 0.3))
```

@jumping_uk doesn't use #machinelearning and #bigdata as often but the figure below shows that these have a significant impact on engagement, 
and so they could be used more often in the future. 

```{r rstats hashtags, echo = FALSE}
rstats_hashtags = tibble(
  hashtags = c("stats", "datascience", "python", 
               "machinelearning", "bigdata"),
  used = c(80.71, 35.73, 37.28, 36.1, 40.3),
  not_used = c(29.45, 24.62, 24, 25.14, 22.35)
)
rstats_hashtags %>%
  pivot_longer(cols = c("used", "not_used"),
               names_to = "interactions",
               values_to = "count") %>%
  ggplot(aes(hashtags, count, fill = interactions)) +
           geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Dark2", 
                    name = "Hashtag Used",
                    labels = c("No", "Yes")) +
  labs(title = "Impact of hashtags used alongside #rstats",
       caption = "Taken from #rstats tweets from 07/07 - 14/07") +
  xlab("Hashtag") +
  ylab("Average Interactions") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 30,
                                   size = 6,
                                   vjust = 0.7),
        plot.title = element_text(hjust = 0.5))

```

There are also hashtag trends such as #100daysofcode and #tidytuesdays which 
could be good ways to appear more on the RStats community timeline (there are 
two accounts that retweet all tweets with #100daysofcode). 

```{r retweeters, echo = FALSE}
retweeters = read.csv("Data/retweeters.csv")

jr = c("csgillespie", "nrennie35", "StatsRhian", 
       "MandyNorrbo", "clayyb93", "AbrahamsAmieroh",
       "jwalton3141", "parisagregg", "haematobot",
       "_jcken", "TimBrock_DtD")

retweeters %<>%
  mutate(jumping_rivers = screen_name %in% jr) %>%
  select(user_id, screen_name, followers_count, jumping_rivers)

```


